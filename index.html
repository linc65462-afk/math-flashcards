<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº”å¹´çº§ä¸Šå†Œè‹æ•™ç‰ˆæ•°å­¦é—ªå¡å­¦ä¹ ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #2c3e50;
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #ecf0f1;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .main-nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .nav-btn {
            padding: 14px 28px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .nav-btn:hover {
            background: #2980b9;
            transform: translateY(-3px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }
        
        .nav-btn i {
            font-size: 1.2rem;
        }
        
        .page {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-top: 20px;
            min-height: 500px;
        }
        
        .active-page {
            display: block;
        }
        
        /* é—ªå¡æ ·å¼ */
        .flashcard-container {
            perspective: 1000px;
            width: 100%;
            max-width: 800px;
            height: 500px;
            margin: 30px auto;
        }
        
        .flashcard {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.8s;
            cursor: pointer;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .flashcard.flipped {
            transform: rotateY(180deg);
        }
        
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 30px;
            overflow: auto;
        }
        
        .card-front {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }
        
        .card-back {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            transform: rotateY(180deg);
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-weight: 600;
            text-align: center;
        }
        
        .card-content {
            font-size: 1.5rem;
            text-align: center;
            width: 100%;
            margin-bottom: 10px;
            flex-grow: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        .card-logic {
            font-size: 1.2rem;
            line-height: 1.5;
            width: 100%;
            flex-grow: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }
        
        .card-images-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin: 10px 0;
            width: 100%;
            max-height: 220px;
            overflow-y: auto;
            padding: 5px;
        }
        
        .card-image {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            object-fit: contain;
            background: white;
            padding: 2px;
        }
        
        .card-tags {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
            width: 100%;
        }
        
        .card-tag {
            padding: 5px 12px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            font-size: 0.85rem;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        /* å­¦ä¹ æ§åˆ¶æŒ‰é’® */
        .study-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        .control-btn {
            padding: 12px 24px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .control-btn:hover {
            background: #27ae60;
            transform: translateY(-3px);
        }
        
        .control-btn.secondary {
            background: #e74c3c;
        }
        
        .control-btn.secondary:hover {
            background: #c0392b;
        }
        
        /* æ ‡ç­¾æ ·å¼ */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .tag {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .tag:hover {
            background: #2980b9;
            transform: scale(1.05);
        }
        
        .tag.active {
            background: #2c3e50;
        }
        
        .add-tag-btn {
            padding: 8px 16px;
            background: #2ecc71;
            color: white;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }
        
        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: #3498db;
            outline: none;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ */
        .image-upload-area {
            border: 2px dashed #3498db;
            border-radius: 10px;
            padding: 25px;
            text-align: center;
            background: #f8fafc;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        
        .image-upload-area:hover {
            background: #e3f2fd;
            border-color: #2980b9;
        }
        
        .image-upload-area.dragover {
            background: #bbdefb;
            border-color: #1a237e;
        }
        
        .upload-icon {
            font-size: 2.5rem;
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .upload-text {
            font-size: 1.1rem;
            color: #555;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            font-size: 0.9rem;
            color: #777;
        }
        
        .image-preview-container {
            margin-top: 15px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            width: 100%;
        }
        
        .image-preview-item {
            position: relative;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .preview-image {
            width: 100%;
            height: 120px;
            object-fit: contain;
            border-radius: 5px;
            margin-bottom: 8px;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
        }
        
        .remove-image-btn:hover {
            background: rgba(192, 57, 43, 1);
        }
        
        .upload-section {
            margin-bottom: 25px;
        }
        
        /* é—ªå¡åº“æ ·å¼ */
        .flashcard-library {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .library-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border-left: 5px solid #3498db;
        }
        
        .library-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .library-card-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .card-actions button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
            margin-left: 10px;
            color: #7f8c8d;
            transition: color 0.2s;
        }
        
        .card-actions button:hover {
            color: #e74c3c;
        }
        
        .library-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .library-tag {
            padding: 4px 10px;
            background: #ecf0f1;
            border-radius: 15px;
            font-size: 0.8rem;
            color: #34495e;
        }
        
        /* ç¤¼ç‰©ç‰¹æ•ˆ */
        .gift-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
            overflow: hidden;
        }
        
        .gift-item {
            position: absolute;
            top: -100px;
            font-size: 2.5rem;
            opacity: 0.9;
            z-index: 1001;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.2));
            user-select: none;
            animation-timing-function: linear, ease-in;
            animation-fill-mode: forwards;
        }
        
        @keyframes fallDown {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh - 50px)) rotate(360deg);
                opacity: 0.8;
            }
        }
        
        @keyframes fadeOut {
            0% {
                opacity: 0.8;
            }
            100% {
                opacity: 0;
            }
        }
        
        /* æ ‡ç­¾é¡µé¢æ ·å¼ */
        .tag-page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .back-btn {
            padding: 10px 20px;
            background: #7f8c8d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tag-flashcards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .tag-flashcard {
            background: #3498db;
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .tag-flashcard:hover {
            background: #2980b9;
            transform: translateY(-5px);
        }
        
        .tag-flashcard-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .flashcard-container {
                height: 500px;
            }
            
            .card-content {
                font-size: 1.3rem;
            }
            
            .card-logic {
                font-size: 1.1rem;
            }
            
            .main-nav {
                flex-direction: column;
                align-items: center;
            }
            
            .nav-btn {
                width: 100%;
                max-width: 300px;
                justify-content: center;
            }
            
            .flashcard-library {
                grid-template-columns: 1fr;
            }
            
            .gift-item {
                font-size: 2rem;
            }
            
            .image-preview-container {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .study-info {
            text-align: center;
            margin-top: 20px;
            color: #7f8c8d;
        }
        
        /* ä¿å­˜æç¤º */
        .save-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ecc71;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 10000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* å›¾ç‰‡ä¸Šä¼ å¤šé€‰ */
        .image-counter {
            font-size: 0.85rem;
            color: #3498db;
            margin-top: 5px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-graduation-cap"></i> äº”å¹´çº§ä¸Šå†Œè‹æ•™ç‰ˆæ•°å­¦é—ªå¡å­¦ä¹ ç³»ç»Ÿ</h1>
            <p class="subtitle">é€šè¿‡äº¤äº’å¼é—ªå¡æŒæ¡äº”å¹´çº§ä¸Šå†Œæ•°å­¦çŸ¥è¯†ç‚¹ã€‚ç‚¹å‡»å¡ç‰‡ç¿»è½¬æŸ¥çœ‹è§£é¢˜é€»è¾‘ï¼Œå¯ä¸Šä¼ å¤šå¼ å›¾ç‰‡è¾…åŠ©å­¦ä¹ ã€‚</p>
        </header>
        
        <div class="main-nav">
            <button class="nav-btn" id="startStudyBtn">
                <i class="fas fa-play-circle"></i> å¼€å§‹å­¦ä¹ é—ªå¡
            </button>
            <button class="nav-btn" id="addFlashcardBtn">
                <i class="fas fa-plus-circle"></i> æ·»åŠ æ–°é—ªå¡
            </button>
            <button class="nav-btn" id="selectTagBtn">
                <i class="fas fa-tags"></i> æŒ‰æ ‡ç­¾é€‰æ‹©å­¦ä¹ 
            </button>
            <button class="nav-btn" id="flashcardLibraryBtn">
                <i class="fas fa-book"></i> é—ªå¡åº“ç®¡ç†
            </button>
        </div>
        
        <!-- å­¦ä¹ é¡µé¢ -->
        <div id="studyPage" class="page active-page">
            <div class="tag-page-header">
                <h2><i class="fas fa-book-open"></i> é—ªå¡å­¦ä¹ </h2>
                <div>
                    <button class="control-btn" id="shuffleBtn">
                        <i class="fas fa-random"></i> ä¹±åºå­¦ä¹ 
                    </button>
                    <button class="control-btn" id="giftBtn">
                        <i class="fas fa-gift"></i> ç¤¼ç‰©æƒŠå–œ
                    </button>
                </div>
            </div>
            
            <div class="flashcard-container">
                <div class="flashcard" id="studyFlashcard">
                    <div class="card-face card-front">
                        <div class="card-title">é¢˜ç›®</div>
                        <div class="card-content" id="cardQuestion">
                            ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©æ ‡ç­¾ï¼Œç„¶åç‚¹å‡»å¡ç‰‡å¼€å§‹å­¦ä¹ 
                        </div>
                        <div class="card-images-container" id="cardQuestionImages">
                            <!-- é¢˜ç›®å›¾ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                        <div class="card-tags" id="frontTags">
                            <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                    </div>
                    <div class="card-face card-back">
                        <div class="card-title">è§£é¢˜é€»è¾‘</div>
                        <div class="card-logic" id="cardLogic">
                            è§£é¢˜é€»è¾‘å°†åœ¨è¿™é‡Œæ˜¾ç¤º
                        </div>
                        <div class="card-images-container" id="cardLogicImages">
                            <!-- è§£é¢˜å›¾ç‰‡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                        <div class="card-tags" id="backTags">
                            <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="study-controls">
                <button class="control-btn" id="prevCardBtn">
                    <i class="fas fa-arrow-left"></i> ä¸Šä¸€å¼ 
                </button>
                <button class="control-btn" id="nextCardBtn">
                    ä¸‹ä¸€å¼  <i class="fas fa-arrow-right"></i>
                </button>
                <button class="control-btn secondary" id="backToHomeBtn">
                    <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
                </button>
            </div>
            
            <div class="study-info">
                <p>
                    å½“å‰è¿›åº¦: <span id="currentCardIndex">0</span> / <span id="totalCards">0</span>
                </p>
                <p style="margin-top: 10px; font-size: 0.9rem; color: #95a5a6;">
                    <i class="fas fa-info-circle"></i> æ•°æ®å·²è‡ªåŠ¨ä¿å­˜ï¼Œåˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±
                </p>
            </div>
        </div>
        
        <!-- æ·»åŠ é—ªå¡é¡µé¢ -->
        <div id="addFlashcardPage" class="page">
            <h2><i class="fas fa-plus-circle"></i> æ·»åŠ æ–°é—ªå¡</h2>
            
            <form id="flashcardForm">
                <div class="form-group">
                    <label for="question">é¢˜ç›®/é—®é¢˜:</label>
                    <textarea id="question" placeholder="è¯·è¾“å…¥é¢˜ç›®å†…å®¹..."></textarea>
                    <small style="color: #7f8c8d;">æ³¨æ„ï¼šå¦‚æœä¸Šä¼ é¢˜ç›®å›¾ç‰‡ï¼Œåˆ™æ­¤å¤„å¯ä¸å¡«</small>
                </div>
                
                <div class="upload-section">
                    <label>é¢˜ç›®å›¾ç‰‡ (å¯é€‰ï¼Œå¯ä¸Šä¼ å¤šå¼ ):</label>
                    <div class="image-upload-area" id="questionUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ é¢˜ç›®å›¾ç‰‡</div>
                        <div class="upload-hint">æ”¯æŒ JPG, PNG æ ¼å¼ï¼Œå¯å¤šé€‰ï¼Œæ¯å¼ æœ€å¤§ 5MB</div>
                        <div class="image-counter" id="questionImageCount">å·²é€‰æ‹© 0 å¼ å›¾ç‰‡</div>
                        <input type="file" id="questionImageInput" accept="image/*" multiple style="display: none;">
                    </div>
                    <div class="image-preview-container" id="questionPreview">
                        <!-- é¢˜ç›®å›¾ç‰‡é¢„è§ˆ -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="logic">è§£é¢˜é€»è¾‘/ç­”æ¡ˆ:</label>
                    <textarea id="logic" placeholder="è¯·è¾“å…¥è§£é¢˜é€»è¾‘æˆ–ç­”æ¡ˆ..."></textarea>
                    <small style="color: #7f8c8d;">æ³¨æ„ï¼šå¦‚æœä¸Šä¼ è§£é¢˜å›¾ç‰‡ï¼Œåˆ™æ­¤å¤„å¯ä¸å¡«</small>
                </div>
                
                <div class="upload-section">
                    <label>è§£é¢˜å›¾ç‰‡ (å¯é€‰ï¼Œå¯ä¸Šä¼ å¤šå¼ ):</label>
                    <div class="image-upload-area" id="logicUploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ è§£é¢˜å›¾ç‰‡</div>
                        <div class="upload-hint">æ”¯æŒ JPG, PNG æ ¼å¼ï¼Œå¯å¤šé€‰ï¼Œæ¯å¼ æœ€å¤§ 5MB</div>
                        <div class="image-counter" id="logicImageCount">å·²é€‰æ‹© 0 å¼ å›¾ç‰‡</div>
                        <input type="file" id="logicImageInput" accept="image/*" multiple style="display: none;">
                    </div>
                    <div class="image-preview-container" id="logicPreview">
                        <!-- è§£é¢˜å›¾ç‰‡é¢„è§ˆ -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>é€‰æ‹©æ ‡ç­¾:</label>
                    <div class="tags-container" id="formTags">
                        <!-- æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                    </div>
                    
                    <div style="margin-top: 15px;">
                        <input type="text" id="newTag" placeholder="è¾“å…¥æ–°æ ‡ç­¾åç§°" style="width: auto; display: inline-block;">
                        <button type="button" class="add-tag-btn" id="addTagBtn">
                            <i class="fas fa-plus"></i> æ·»åŠ æ ‡ç­¾
                        </button>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="control-btn">
                        <i class="fas fa-save"></i> ä¿å­˜é—ªå¡
                    </button>
                    <button type="button" class="control-btn secondary" id="cancelAddBtn">
                        <i class="fas fa-times"></i> å–æ¶ˆ
                    </button>
                </div>
            </form>
        </div>
        
        <!-- æŒ‰æ ‡ç­¾é€‰æ‹©é¡µé¢ -->
        <div id="selectTagPage" class="page">
            <div class="tag-page-header">
                <h2><i class="fas fa-tags"></i> æŒ‰æ ‡ç­¾é€‰æ‹©å­¦ä¹ </h2>
                <button class="back-btn" id="backFromTagsBtn">
                    <i class="fas fa-arrow-left"></i> è¿”å›
                </button>
            </div>
            
            <p style="margin-bottom: 20px; color: #7f8c8d;">ç‚¹å‡»æ ‡ç­¾æŸ¥çœ‹è¯¥æ ‡ç­¾ä¸‹çš„æ‰€æœ‰é—ªå¡</p>
            
            <div class="tags-container" id="allTagsContainer">
                <!-- æ‰€æœ‰æ ‡ç­¾å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
            
            <div id="tagFlashcardsContainer" class="hidden">
                <h3 id="selectedTagTitle" style="margin: 30px 0 20px 0;"></h3>
                <div class="tag-flashcards" id="tagFlashcards">
                    <!-- æ ‡ç­¾ä¸‹çš„é—ªå¡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
                </div>
            </div>
        </div>
        
        <!-- é—ªå¡åº“é¡µé¢ -->
        <div id="flashcardLibraryPage" class="page">
            <div class="tag-page-header">
                <h2><i class="fas fa-book"></i> é—ªå¡åº“ç®¡ç†</h2>
                <button class="back-btn" id="backFromLibraryBtn">
                    <i class="fas fa-arrow-left"></i> è¿”å›é¦–é¡µ
                </button>
            </div>
            
            <p style="margin-bottom: 20px; color: #7f8c8d;">æ‚¨å¯ä»¥ç¼–è¾‘æˆ–åˆ é™¤å·²æœ‰çš„é—ªå¡</p>
            
            <div class="flashcard-library" id="flashcardLibrary">
                <!-- é—ªå¡å°†é€šè¿‡JSåŠ¨æ€æ·»åŠ  -->
            </div>
        </div>
        
        <!-- ç¤¼ç‰©ç‰¹æ•ˆå®¹å™¨ -->
        <div class="gift-container" id="giftContainer"></div>
    </div>
    
    <script>
        // æ•°æ®å­˜å‚¨é”®å
        const FLASHCARDS_STORAGE_KEY = 'math_flashcards_data';
        const TAGS_STORAGE_KEY = 'math_flashcards_tags';
        
        // åˆå§‹åŒ–æ•°æ® - ä»localStorageåŠ è½½æˆ–ä½¿ç”¨é»˜è®¤æ•°æ®
        function loadData() {
            const savedFlashcards = localStorage.getItem(FLASHCARDS_STORAGE_KEY);
            const savedTags = localStorage.getItem(TAGS_STORAGE_KEY);
            
            if (savedFlashcards) {
                flashcards = JSON.parse(savedFlashcards);
            } else {
                // é»˜è®¤é—ªå¡æ•°æ®
                flashcards = [
                    {
                        id: 1,
                        question: "ä¸€ä¸ªé•¿æ–¹å½¢çš„é•¿æ˜¯8å˜ç±³ï¼Œå®½æ˜¯5å˜ç±³ï¼Œå®ƒçš„å‘¨é•¿æ˜¯å¤šå°‘å˜ç±³ï¼Ÿ",
                        logic: "é•¿æ–¹å½¢å‘¨é•¿å…¬å¼ï¼šå‘¨é•¿ = (é•¿ + å®½) Ã— 2ã€‚æ‰€ä»¥å‘¨é•¿ = (8 + 5) Ã— 2 = 13 Ã— 2 = 26å˜ç±³ã€‚",
                        tags: ["å‡ ä½•", "å‘¨é•¿"],
                        questionImages: [],
                        logicImages: []
                    },
                    {
                        id: 2,
                        question: "å°æ˜æœ‰36é¢—ç³–ï¼Œä»–æƒ³å¹³å‡åˆ†ç»™4ä¸ªæœ‹å‹ï¼Œæ¯äººèƒ½åˆ†åˆ°å‡ é¢—ç³–ï¼Ÿ",
                        logic: "è¿™æ˜¯ä¸€ä¸ªé™¤æ³•é—®é¢˜ï¼š36 Ã· 4 = 9ã€‚æ‰€ä»¥æ¯ä¸ªæœ‹å‹å¯ä»¥åˆ†åˆ°9é¢—ç³–ã€‚",
                        tags: ["é™¤æ³•", "åº”ç”¨é¢˜"],
                        questionImages: [],
                        logicImages: []
                    },
                    {
                        id: 3,
                        question: "è®¡ç®—ï¼š3/5 + 1/5 = ?",
                        logic: "åŒåˆ†æ¯åˆ†æ•°ç›¸åŠ ï¼Œåˆ†æ¯ä¸å˜ï¼Œåˆ†å­ç›¸åŠ ï¼š3/5 + 1/5 = (3+1)/5 = 4/5ã€‚",
                        tags: ["åˆ†æ•°", "åŠ æ³•"],
                        questionImages: [],
                        logicImages: []
                    },
                    {
                        id: 4,
                        question: "ä¸€ä¸ªæ­£æ–¹å½¢çš„è¾¹é•¿æ˜¯6å˜ç±³ï¼Œå®ƒçš„é¢ç§¯æ˜¯å¤šå°‘å¹³æ–¹å˜ç±³ï¼Ÿ",
                        logic: "æ­£æ–¹å½¢é¢ç§¯å…¬å¼ï¼šé¢ç§¯ = è¾¹é•¿ Ã— è¾¹é•¿ã€‚æ‰€ä»¥é¢ç§¯ = 6 Ã— 6 = 36å¹³æ–¹å˜ç±³ã€‚",
                        tags: ["å‡ ä½•", "é¢ç§¯"],
                        questionImages: [],
                        logicImages: []
                    },
                    {
                        id: 5,
                        question: "å°åä¹°äº†3æœ¬ç»ƒä¹ æœ¬ï¼Œæ¯æœ¬4å…ƒï¼Œä»–ä»˜äº†20å…ƒï¼Œåº”æ‰¾å›å¤šå°‘å…ƒï¼Ÿ",
                        logic: "é¦–å…ˆè®¡ç®—æ€»ä»·ï¼š3 Ã— 4 = 12å…ƒã€‚ç„¶åè®¡ç®—æ‰¾å›çš„é’±ï¼š20 - 12 = 8å…ƒã€‚æ‰€ä»¥åº”æ‰¾å›8å…ƒã€‚",
                        tags: ["ä¹˜æ³•", "å‡æ³•", "åº”ç”¨é¢˜"],
                        questionImages: [],
                        logicImages: []
                    },
                    {
                        id: 6,
                        question: "æŠŠ0.25åŒ–æˆåˆ†æ•°æ˜¯å¤šå°‘ï¼Ÿ",
                        logic: "0.25 = 25/100 = 1/4ã€‚æ‰€ä»¥0.25åŒ–æˆåˆ†æ•°æ˜¯1/4ã€‚",
                        tags: ["å°æ•°", "åˆ†æ•°", "è½¬æ¢"],
                        questionImages: [],
                        logicImages: []
                    }
                ];
                saveFlashcards(); // ä¿å­˜é»˜è®¤æ•°æ®
            }
            
            if (savedTags) {
                tags = JSON.parse(savedTags);
            } else {
                // é»˜è®¤æ ‡ç­¾æ•°æ®
                tags = ["å‡ ä½•", "å‘¨é•¿", "é¢ç§¯", "åˆ†æ•°", "å°æ•°", "åŠ æ³•", "å‡æ³•", "ä¹˜æ³•", "é™¤æ³•", "åº”ç”¨é¢˜", "è½¬æ¢"];
                saveTags(); // ä¿å­˜é»˜è®¤æ•°æ®
            }
        }
        
        // ä¿å­˜é—ªå¡æ•°æ®åˆ°localStorage
        function saveFlashcards() {
            localStorage.setItem(FLASHCARDS_STORAGE_KEY, JSON.stringify(flashcards));
            showSaveIndicator('é—ªå¡æ•°æ®å·²ä¿å­˜');
        }
        
        // ä¿å­˜æ ‡ç­¾æ•°æ®åˆ°localStorage
        function saveTags() {
            localStorage.setItem(TAGS_STORAGE_KEY, JSON.stringify(tags));
            showSaveIndicator('æ ‡ç­¾æ•°æ®å·²ä¿å­˜');
        }
        
        // æ˜¾ç¤ºä¿å­˜æç¤º
        function showSaveIndicator(message) {
            // ç§»é™¤å·²æœ‰çš„æç¤º
            const existingIndicator = document.querySelector('.save-indicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            
            // åˆ›å»ºæ–°çš„æç¤º
            const indicator = document.createElement('div');
            indicator.className = 'save-indicator';
            indicator.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            document.body.appendChild(indicator);
            
            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (indicator.parentNode) {
                    indicator.remove();
                }
            }, 3000);
        }
        
        // é—ªå¡æ•°æ®å­˜å‚¨ï¼ˆå°†ä»localStorageåŠ è½½ï¼‰
        let flashcards = [];
        
        // æ ‡ç­¾æ•°æ®ï¼ˆå°†ä»localStorageåŠ è½½ï¼‰
        let tags = [];
        
        // å½“å‰å­¦ä¹ çŠ¶æ€
        let currentStudyIndex = 0;
        let currentStudyTag = "all";
        let studyDeck = [];
        
        // å½“å‰ä¸Šä¼ çš„å›¾ç‰‡æ•°æ®
        let currentQuestionImages = [];
        let currentLogicImages = [];
        
        // å¡é€šå›¾æ¡ˆåˆ—è¡¨
        const giftItems = [
            "ğŸ±", "ğŸ¶", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", "ğŸ¦", "ğŸ®",
            "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¤", "ğŸ¦„", "ğŸ™", "ğŸ ",
            "ğŸŒŸ", "â­", "ğŸ€", "ğŸ", "ğŸˆ", "ğŸ‰", "ğŸŠ", "ğŸ“š", "âœï¸", "ğŸ“",
            "ğŸ§®", "ğŸ¯", "ğŸ†", "ğŸ‘", "â¤ï¸", "ğŸ’¡", "ğŸ¨", "ğŸ®", "ğŸµ", "ğŸ‚"
        ];
        
        // DOMå…ƒç´ 
        const studyPage = document.getElementById('studyPage');
        const addFlashcardPage = document.getElementById('addFlashcardPage');
        const selectTagPage = document.getElementById('selectTagPage');
        const flashcardLibraryPage = document.getElementById('flashcardLibraryPage');
        
        const startStudyBtn = document.getElementById('startStudyBtn');
        const addFlashcardBtn = document.getElementById('addFlashcardBtn');
        const selectTagBtn = document.getElementById('selectTagBtn');
        const flashcardLibraryBtn = document.getElementById('flashcardLibraryBtn');
        
        const studyFlashcard = document.getElementById('studyFlashcard');
        const cardQuestion = document.getElementById('cardQuestion');
        const cardLogic = document.getElementById('cardLogic');
        const cardQuestionImages = document.getElementById('cardQuestionImages');
        const cardLogicImages = document.getElementById('cardLogicImages');
        const frontTags = document.getElementById('frontTags');
        const backTags = document.getElementById('backTags');
        
        const prevCardBtn = document.getElementById('prevCardBtn');
        const nextCardBtn = document.getElementById('nextCardBtn');
        const backToHomeBtn = document.getElementById('backToHomeBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');
        const giftBtn = document.getElementById('giftBtn');
        
        const flashcardForm = document.getElementById('flashcardForm');
        const cancelAddBtn = document.getElementById('cancelAddBtn');
        
        const backFromTagsBtn = document.getElementById('backFromTagsBtn');
        const backFromLibraryBtn = document.getElementById('backFromLibraryBtn');
        
        const formTags = document.getElementById('formTags');
        const allTagsContainer = document.getElementById('allTagsContainer');
        
        const currentCardIndex = document.getElementById('currentCardIndex');
        const totalCards = document.getElementById('totalCards');
        const giftContainer = document.getElementById('giftContainer');
        
        // å›¾ç‰‡ä¸Šä¼ ç›¸å…³å…ƒç´ 
        const questionUploadArea = document.getElementById('questionUploadArea');
        const questionImageInput = document.getElementById('questionImageInput');
        const questionPreview = document.getElementById('questionPreview');
        const questionImageCount = document.getElementById('questionImageCount');
        
        const logicUploadArea = document.getElementById('logicUploadArea');
        const logicImageInput = document.getElementById('logicImageInput');
        const logicPreview = document.getElementById('logicPreview');
        const logicImageCount = document.getElementById('logicImageCount');
        
        // é¡µé¢åˆ‡æ¢åŠŸèƒ½
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active-page');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            document.getElementById(pageId).classList.add('active-page');
            
            // å¦‚æœæ˜¾ç¤ºå­¦ä¹ é¡µé¢ï¼Œåˆå§‹åŒ–å­¦ä¹ å†…å®¹
            if (pageId === 'studyPage') {
                initStudyPage();
            }
            
            // å¦‚æœæ˜¾ç¤ºæ ‡ç­¾é€‰æ‹©é¡µé¢ï¼Œåˆå§‹åŒ–æ ‡ç­¾
            if (pageId === 'selectTagPage') {
                initTagSelectionPage();
            }
            
            // å¦‚æœæ˜¾ç¤ºé—ªå¡åº“é¡µé¢ï¼ŒåŠ è½½é—ªå¡
            if (pageId === 'flashcardLibraryPage') {
                loadFlashcardLibrary();
            }
        }
        
        // åˆå§‹åŒ–å­¦ä¹ é¡µé¢
        function initStudyPage() {
            // æ ¹æ®å½“å‰æ ‡ç­¾ç­›é€‰é—ªå¡
            filterStudyDeck();
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateProgress();
            
            // æ˜¾ç¤ºç¬¬ä¸€å¼ å¡ç‰‡
            showCard(currentStudyIndex);
        }
        
        // æ ¹æ®æ ‡ç­¾ç­›é€‰å­¦ä¹ å¡ç‰‡
        function filterStudyDeck() {
            if (currentStudyTag === "all") {
                studyDeck = [...flashcards];
            } else {
                studyDeck = flashcards.filter(card => 
                    card.tags && card.tags.includes(currentStudyTag)
                );
            }
            
            // å¦‚æœæ²¡æœ‰å¡ç‰‡ï¼Œæ˜¾ç¤ºæç¤º
            if (studyDeck.length === 0) {
                cardQuestion.textContent = `æ²¡æœ‰æ‰¾åˆ°å±äº"${currentStudyTag}"æ ‡ç­¾çš„é—ªå¡ï¼Œè¯·æ·»åŠ æˆ–é€‰æ‹©å…¶ä»–æ ‡ç­¾`;
                cardLogic.textContent = "è¯·åœ¨æ·»åŠ é—ªå¡é¡µé¢åˆ›å»ºæ–°é—ªå¡ï¼Œæˆ–è¿”å›é¦–é¡µé€‰æ‹©å…¶ä»–æ ‡ç­¾";
                cardQuestionImages.innerHTML = "";
                cardLogicImages.innerHTML = "";
                frontTags.innerHTML = "";
                backTags.innerHTML = "";
            }
        }
        
        // æ˜¾ç¤ºæŒ‡å®šç´¢å¼•çš„å¡ç‰‡
        function showCard(index) {
            // ç¡®ä¿å¡ç‰‡æ­£é¢æœä¸Š
            studyFlashcard.classList.remove('flipped');
            
            if (studyDeck.length === 0) return;
            
            // ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…
            if (index < 0) index = studyDeck.length - 1;
            if (index >= studyDeck.length) index = 0;
            
            currentStudyIndex = index;
            const card = studyDeck[index];
            
            // æ›´æ–°å¡ç‰‡å†…å®¹
            cardQuestion.textContent = card.question;
            cardLogic.textContent = card.logic;
            
            // æ›´æ–°é¢˜ç›®å›¾ç‰‡
            cardQuestionImages.innerHTML = "";
            if (card.questionImages && card.questionImages.length > 0) {
                card.questionImages.forEach((imageData, i) => {
                    const img = document.createElement('img');
                    img.src = imageData;
                    img.alt = `é¢˜ç›®å›¾ç‰‡ ${i+1}`;
                    img.className = "card-image";
                    cardQuestionImages.appendChild(img);
                });
            }
            
            // æ›´æ–°è§£é¢˜å›¾ç‰‡
            cardLogicImages.innerHTML = "";
            if (card.logicImages && card.logicImages.length > 0) {
                card.logicImages.forEach((imageData, i) => {
                    const img = document.createElement('img');
                    img.src = imageData;
                    img.alt = `è§£é¢˜å›¾ç‰‡ ${i+1}`;
                    img.className = "card-image";
                    cardLogicImages.appendChild(img);
                });
            }
            
            // æ›´æ–°æ ‡ç­¾æ˜¾ç¤º
            updateCardTags(card);
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            updateProgress();
        }
        
        // æ›´æ–°å¡ç‰‡ä¸Šçš„æ ‡ç­¾æ˜¾ç¤º
        function updateCardTags(card) {
            frontTags.innerHTML = "";
            backTags.innerHTML = "";
            
            if (card.tags && card.tags.length > 0) {
                card.tags.forEach(tag => {
                    const frontTag = document.createElement('span');
                    frontTag.className = 'card-tag';
                    frontTag.textContent = tag;
                    frontTags.appendChild(frontTag);
                    
                    const backTag = document.createElement('span');
                    backTag.className = 'card-tag';
                    backTag.textContent = tag;
                    backTags.appendChild(backTag);
                });
            } else {
                const noTag = document.createElement('span');
                noTag.className = 'card-tag';
                noTag.textContent = "æ— æ ‡ç­¾";
                frontTags.appendChild(noTag);
                backTags.appendChild(noTag.cloneNode(true));
            }
        }
        
        // æ›´æ–°å­¦ä¹ è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            currentCardIndex.textContent = studyDeck.length > 0 ? currentStudyIndex + 1 : 0;
            totalCards.textContent = studyDeck.length;
        }
        
        // åˆå§‹åŒ–æ ‡ç­¾é€‰æ‹©é¡µé¢
        function initTagSelectionPage() {
            allTagsContainer.innerHTML = "";
            
            // æ·»åŠ "å…¨éƒ¨"æ ‡ç­¾
            const allTag = document.createElement('span');
            allTag.className = 'tag';
            allTag.textContent = "å…¨éƒ¨";
            allTag.addEventListener('click', () => {
                showTagFlashcards("å…¨éƒ¨", flashcards);
            });
            allTagsContainer.appendChild(allTag);
            
            // æ·»åŠ å…¶ä»–æ ‡ç­¾
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag;
                tagElement.addEventListener('click', () => {
                    const taggedCards = flashcards.filter(card => 
                        card.tags && card.tags.includes(tag)
                    );
                    showTagFlashcards(tag, taggedCards);
                });
                
                allTagsContainer.appendChild(tagElement);
            });
        }
        
        // æ˜¾ç¤ºæ ‡ç­¾ä¸‹çš„é—ªå¡
        function showTagFlashcards(tagName, cards) {
            document.getElementById('selectedTagTitle').textContent = `"${tagName}"æ ‡ç­¾ä¸‹çš„é—ªå¡ (${cards.length}å¼ )`;
            
            const tagFlashcards = document.getElementById('tagFlashcards');
            tagFlashcards.innerHTML = "";
            
            if (cards.length === 0) {
                tagFlashcards.innerHTML = '<p style="color:#7f8c8d; text-align:center; width:100%;">è¯¥æ ‡ç­¾ä¸‹æš‚æ— é—ªå¡</p>';
            } else {
                cards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'tag-flashcard';
                    cardElement.innerHTML = `
                        <div class="tag-flashcard-title">${card.question.substring(0, 30)}${card.question.length > 30 ? '...' : ''}</div>
                        <div>ç‚¹å‡»å¼€å§‹å­¦ä¹ </div>
                    `;
                    
                    cardElement.addEventListener('click', () => {
                        // è®¾ç½®å½“å‰å­¦ä¹ æ ‡ç­¾
                        currentStudyTag = tagName === "å…¨éƒ¨" ? "all" : tagName;
                        
                        // åˆ‡æ¢åˆ°å­¦ä¹ é¡µé¢
                        showPage('studyPage');
                        
                        // ç­›é€‰å¡ç‰‡
                        filterStudyDeck();
                        
                        // æ‰¾åˆ°å½“å‰å¡ç‰‡çš„ç´¢å¼•
                        const cardIndex = studyDeck.findIndex(c => c.id === card.id);
                        currentStudyIndex = cardIndex >= 0 ? cardIndex : 0;
                        
                        // æ˜¾ç¤ºå¡ç‰‡
                        showCard(currentStudyIndex);
                    });
                    
                    tagFlashcards.appendChild(cardElement);
                });
            }
            
            // æ˜¾ç¤ºé—ªå¡å®¹å™¨
            document.getElementById('tagFlashcardsContainer').classList.remove('hidden');
        }
        
        // åŠ è½½é—ªå¡åº“
        function loadFlashcardLibrary() {
            const library = document.getElementById('flashcardLibrary');
            library.innerHTML = "";
            
            if (flashcards.length === 0) {
                library.innerHTML = '<p style="color:#7f8c8d; text-align:center; width:100%;">æš‚æ— é—ªå¡ï¼Œè¯·æ·»åŠ æ–°é—ªå¡</p>';
                return;
            }
            
            flashcards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'library-card';
                
                let questionPreview = card.question || "";
                let logicPreview = card.logic || "";
                
                if (questionPreview.length > 80) questionPreview = questionPreview.substring(0, 80) + '...';
                if (logicPreview.length > 100) logicPreview = logicPreview.substring(0, 100) + '...';
                
                cardElement.innerHTML = `
                    <div class="library-card-header">
                        <h3>é—ªå¡ #${card.id}</h3>
                        <div class="card-actions">
                            <button class="edit-btn" data-id="${card.id}"><i class="fas fa-edit"></i></button>
                            <button class="delete-btn" data-id="${card.id}"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <p><strong>é¢˜ç›®:</strong> ${questionPreview || '[å›¾ç‰‡é¢˜ç›®]'}</p>
                    <p><strong>è§£é¢˜é€»è¾‘:</strong> ${logicPreview || '[å›¾ç‰‡è§£ç­”]'}</p>
                    <div style="font-size:0.8rem; color:#7f8c8d; margin:5px 0;">
                        <i class="fas fa-image"></i> é¢˜ç›®å›¾ç‰‡: ${card.questionImages ? card.questionImages.length : 0}å¼  | 
                        è§£é¢˜å›¾ç‰‡: ${card.logicImages ? card.logicImages.length : 0}å¼ 
                    </div>
                    <div class="library-tags">
                        ${card.tags.map(tag => `<span class="library-tag">${tag}</span>`).join('')}
                    </div>
                `;
                
                library.appendChild(cardElement);
            });
            
            // æ·»åŠ ç¼–è¾‘å’Œåˆ é™¤åŠŸèƒ½
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    editFlashcard(id);
                });
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    deleteFlashcard(id);
                });
            });
        }
        
        // ç¼–è¾‘é—ªå¡
        function editFlashcard(id) {
            const cardIndex = flashcards.findIndex(card => card.id === id);
            if (cardIndex !== -1) {
                const card = flashcards[cardIndex];
                
                // å¡«å……è¡¨å•
                document.getElementById('question').value = card.question;
                document.getElementById('logic').value = card.logic;
                
                // è®¾ç½®æ ‡ç­¾
                updateFormTags(card.tags);
                
                // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
                currentQuestionImages = [...(card.questionImages || [])];
                currentLogicImages = [...(card.logicImages || [])];
                
                updateImagePreview(questionPreview, currentQuestionImages, "question");
                updateImagePreview(logicPreview, currentLogicImages, "logic");
                
                updateImageCount();
                
                // æ˜¾ç¤ºæ·»åŠ é¡µé¢
                showPage('addFlashcardPage');
                
                // ä¸´æ—¶å­˜å‚¨ç¼–è¾‘çš„å¡ç‰‡ID
                flashcardForm.dataset.editingId = id;
            }
        }
        
        // åˆ é™¤é—ªå¡
        function deleteFlashcard(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ é—ªå¡å—ï¼Ÿ')) {
                flashcards = flashcards.filter(card => card.id !== id);
                saveFlashcards();
                loadFlashcardLibrary();
                
                // å¦‚æœæ­£åœ¨å­¦ä¹ è¿™å¼ å¡ç‰‡ï¼Œæ›´æ–°å­¦ä¹ é¡µé¢
                if (studyPage.classList.contains('active-page')) {
                    initStudyPage();
                }
            }
        }
        
        // æ›´æ–°è¡¨å•ä¸­çš„æ ‡ç­¾
        function updateFormTags(selectedTags = []) {
            formTags.innerHTML = "";
            
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                if (selectedTags.includes(tag)) {
                    tagElement.classList.add('active');
                }
                tagElement.dataset.tag = tag;
                tagElement.textContent = tag;
                tagElement.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
                
                formTags.appendChild(tagElement);
            });
        }
        
        // æ›´æ–°å›¾ç‰‡é¢„è§ˆ
        function updateImagePreview(previewContainer, images, type) {
            previewContainer.innerHTML = "";
            
            images.forEach((imageData, index) => {
                const previewItem = document.createElement('div');
                previewItem.className = 'image-preview-item';
                
                const img = document.createElement('img');
                img.src = imageData;
                img.alt = type === "question" ? `é¢˜ç›®å›¾ç‰‡ ${index+1}` : `è§£é¢˜å›¾ç‰‡ ${index+1}`;
                img.className = "preview-image";
                
                const removeBtn = document.createElement('button');
                removeBtn.type = "button";
                removeBtn.className = "remove-image-btn";
                removeBtn.innerHTML = 'Ã—';
                removeBtn.addEventListener('click', function() {
                    if (type === "question") {
                        currentQuestionImages.splice(index, 1);
                        updateImagePreview(questionPreview, currentQuestionImages, "question");
                    } else {
                        currentLogicImages.splice(index, 1);
                        updateImagePreview(logicPreview, currentLogicImages, "logic");
                    }
                    updateImageCount();
                });
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                previewContainer.appendChild(previewItem);
            });
        }
        
        // æ›´æ–°å›¾ç‰‡è®¡æ•°æ˜¾ç¤º
        function updateImageCount() {
            questionImageCount.textContent = `å·²é€‰æ‹© ${currentQuestionImages.length} å¼ å›¾ç‰‡`;
            logicImageCount.textContent = `å·²é€‰æ‹© ${currentLogicImages.length} å¼ å›¾ç‰‡`;
        }
        
        // å¤„ç†å›¾ç‰‡ä¸Šä¼ 
        function setupImageUpload(uploadArea, fileInput, previewContainer, type) {
            // ç‚¹å‡»ä¸Šä¼ åŒºåŸŸ
            uploadArea.addEventListener('click', function() {
                fileInput.click();
            });
            
            // æ–‡ä»¶é€‰æ‹©å˜åŒ–
            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    const files = Array.from(e.target.files);
                    processImageFiles(files, previewContainer, type);
                }
            });
            
            // æ‹–æ”¾åŠŸèƒ½
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                this.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    const files = Array.from(e.dataTransfer.files);
                    processImageFiles(files, previewContainer, type);
                }
            });
        }
        
        // å¤„ç†å¤šå¼ å›¾ç‰‡æ–‡ä»¶
        function processImageFiles(files, previewContainer, type) {
            const validFiles = [];
            
            // è¿‡æ»¤æœ‰æ•ˆæ–‡ä»¶
            files.forEach(file => {
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (!file.type.match('image.*')) {
                    alert(`æ–‡ä»¶ "${file.name}" ä¸æ˜¯å›¾ç‰‡æ–‡ä»¶ï¼Œå·²è·³è¿‡`);
                    return;
                }
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæœ€å¤§5MBï¼‰
                if (file.size > 5 * 1024 * 1024) {
                    alert(`å›¾ç‰‡ "${file.name}" å¤ªå¤§ï¼ˆ${(file.size / 1024 / 1024).toFixed(2)}MBï¼‰ï¼Œè¯·é€‰æ‹©å°äº5MBçš„å›¾ç‰‡`);
                    return;
                }
                
                validFiles.push(file);
            });
            
            if (validFiles.length === 0) return;
            
            // å¤„ç†æ¯ä¸ªæœ‰æ•ˆæ–‡ä»¶
            let processedCount = 0;
            
            validFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    if (type === "question") {
                        currentQuestionImages.push(e.target.result);
                        updateImagePreview(previewContainer, currentQuestionImages, type);
                    } else {
                        currentLogicImages.push(e.target.result);
                        updateImagePreview(previewContainer, currentLogicImages, type);
                    }
                    
                    processedCount++;
                    
                    // æ‰€æœ‰æ–‡ä»¶å¤„ç†å®Œæˆåæ›´æ–°è®¡æ•°
                    if (processedCount === validFiles.length) {
                        updateImageCount();
                    }
                };
                reader.readAsDataURL(file);
            });
        }
        
        // ç¤¼ç‰©ç‰¹æ•ˆï¼šéšæœºæ‰è½å¡é€šå›¾æ¡ˆ
        function createGiftEffect() {
            // æ¸…ç©ºä¹‹å‰çš„ç¤¼ç‰©
            giftContainer.innerHTML = '';
            
            // éšæœºç”Ÿæˆ15-25ä¸ªç¤¼ç‰©
            const giftCount = Math.floor(Math.random() * 11) + 15;
            
            for (let i = 0; i < giftCount; i++) {
                const giftItem = document.createElement('div');
                giftItem.className = 'gift-item';
                
                // éšæœºé€‰æ‹©å¡é€šå›¾æ¡ˆ
                const randomItem = giftItems[Math.floor(Math.random() * giftItems.length)];
                giftItem.textContent = randomItem;
                
                // éšæœºä½ç½®
                const leftPosition = Math.random() * 100;
                giftItem.style.left = leftPosition + 'vw';
                
                // éšæœºå¤§å°
                const size = Math.random() * 0.8 + 0.7;
                giftItem.style.fontSize = (size * 2.5) + 'rem';
                
                // éšæœºé¢œè‰²ï¼ˆéƒ¨åˆ†è¡¨æƒ…ç¬¦å·å¯ä»¥ä½¿ç”¨CSS filterè°ƒæ•´é¢œè‰²ï¼‰
                const hue = Math.random() * 360;
                giftItem.style.filter = `drop-shadow(0 5px 5px rgba(0,0,0,0.2)) hue-rotate(${hue}deg)`;
                
                // éšæœºæ—‹è½¬è§’åº¦
                const rotate = Math.random() * 360;
                giftItem.style.transform = `rotate(${rotate}deg)`;
                
                // éšæœºæ‰è½æ—¶é—´
                const fallDuration = Math.random() * 2000 + 2000; // 2-4ç§’
                const fadeDuration = 2000; // 2ç§’æ·¡å‡º
                
                // æ·»åŠ åˆ°å®¹å™¨
                giftContainer.appendChild(giftItem);
                
                // è®¾ç½®åŠ¨ç”»
                giftItem.style.animation = `fallDown ${fallDuration}ms linear, fadeOut ${fadeDuration}ms ${fallDuration}ms ease-in forwards`;
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤å…ƒç´ 
                setTimeout(() => {
                    if (giftItem.parentNode === giftContainer) {
                        giftItem.remove();
                    }
                }, fallDuration + fadeDuration + 100);
            }
            
            // æ’­æ”¾éŸ³æ•ˆæç¤ºï¼ˆå¯é€‰ï¼‰
            if (typeof Audio !== 'undefined') {
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEAQB8AAEAfAAABAAgAZGF0YQ');
                    audio.volume = 0.3;
                    audio.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾å¤±è´¥:", e));
                } catch (e) {
                    console.log("æ— æ³•æ’­æ”¾éŸ³é¢‘:", e);
                }
            }
        }
        
        // åˆå§‹åŒ–è¡¨å•æ ‡ç­¾
        updateFormTags();
        updateImageCount();
        
        // åˆå§‹åŒ–å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
        setupImageUpload(questionUploadArea, questionImageInput, questionPreview, "question");
        setupImageUpload(logicUploadArea, logicImageInput, logicPreview, "logic");
        
        // äº‹ä»¶ç›‘å¬å™¨
        
        // é¡µé¢åˆ‡æ¢
        startStudyBtn.addEventListener('click', () => showPage('studyPage'));
        addFlashcardBtn.addEventListener('click', () => {
            // é‡ç½®è¡¨å•
            flashcardForm.reset();
            flashcardForm.dataset.editingId = "";
            updateFormTags([]);
            currentQuestionImages = [];
            currentLogicImages = [];
            questionPreview.innerHTML = "";
            logicPreview.innerHTML = "";
            updateImageCount();
            showPage('addFlashcardPage');
        });
        selectTagBtn.addEventListener('click', () => showPage('selectTagPage'));
        flashcardLibraryBtn.addEventListener('click', () => showPage('flashcardLibraryPage'));
        
        // å¡ç‰‡ç¿»è½¬
        studyFlashcard.addEventListener('click', function() {
            this.classList.toggle('flipped');
        });
        
        // å­¦ä¹ æ§åˆ¶
        prevCardBtn.addEventListener('click', () => {
            if (studyDeck.length > 0) {
                showCard(currentStudyIndex - 1);
            }
        });
        
        nextCardBtn.addEventListener('click', () => {
            if (studyDeck.length > 0) {
                showCard(currentStudyIndex + 1);
            }
        });
        
        // ä¿®æ”¹ï¼šè¿”å›é¦–é¡µæŒ‰é’®å›åˆ°å­¦ä¹ é¡µé¢
        backToHomeBtn.addEventListener('click', () => {
            currentStudyTag = "all";
            showPage('studyPage');
        });
        
        // ä¹±åºæŒ‰é’®
        shuffleBtn.addEventListener('click', function() {
            if (studyDeck.length > 0) {
                // æ‰“ä¹±æ•°ç»„
                for (let i = studyDeck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [studyDeck[i], studyDeck[j]] = [studyDeck[j], studyDeck[i]];
                }
                
                // æ˜¾ç¤ºç¬¬ä¸€å¼ å¡ç‰‡
                currentStudyIndex = 0;
                showCard(currentStudyIndex);
                
                // æ›´æ–°æŒ‰é’®æ–‡æœ¬
                const isShuffled = this.textContent.includes("é¡ºåº");
                this.innerHTML = isShuffled ? 
                    '<i class="fas fa-random"></i> ä¹±åºå­¦ä¹ ' : 
                    '<i class="fas fa-sort-amount-down"></i> é¡ºåºå­¦ä¹ ';
            }
        });
        
        // ç¤¼ç‰©ç‰¹æ•ˆ
        giftBtn.addEventListener('click', createGiftEffect);
        
        // è¡¨å•æäº¤
        flashcardForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // è·å–è¡¨å•æ•°æ®
            const question = document.getElementById('question').value;
            const logic = document.getElementById('logic').value;
            
            // è·å–é€‰ä¸­çš„æ ‡ç­¾
            const selectedTags = [];
            document.querySelectorAll('#formTags .tag.active').forEach(tag => {
                selectedTags.push(tag.dataset.tag);
            });
            
            // æ£€æŸ¥æ˜¯å¦è‡³å°‘æä¾›äº†é¢˜ç›®æˆ–é¢˜ç›®å›¾ç‰‡
            if (!question.trim() && currentQuestionImages.length === 0) {
                alert("è¯·è‡³å°‘æä¾›é¢˜ç›®æ–‡å­—æˆ–ä¸Šä¼ é¢˜ç›®å›¾ç‰‡ï¼");
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦è‡³å°‘æä¾›äº†è§£é¢˜é€»è¾‘æˆ–è§£é¢˜å›¾ç‰‡
            if (!logic.trim() && currentLogicImages.length === 0) {
                alert("è¯·è‡³å°‘æä¾›è§£é¢˜é€»è¾‘æ–‡å­—æˆ–ä¸Šä¼ è§£é¢˜å›¾ç‰‡ï¼");
                return;
            }
            
            // æ£€æŸ¥æ˜¯å¦æ­£åœ¨ç¼–è¾‘
            const editingId = this.dataset.editingId;
            
            if (editingId) {
                // æ›´æ–°ç°æœ‰é—ªå¡
                const cardIndex = flashcards.findIndex(card => card.id === parseInt(editingId));
                if (cardIndex !== -1) {
                    flashcards[cardIndex] = {
                        ...flashcards[cardIndex],
                        question,
                        logic,
                        tags: selectedTags,
                        questionImages: [...currentQuestionImages],
                        logicImages: [...currentLogicImages]
                    };
                }
                
                // æ¸…é™¤ç¼–è¾‘çŠ¶æ€
                delete this.dataset.editingId;
            } else {
                // åˆ›å»ºæ–°é—ªå¡
                const newId = flashcards.length > 0 ? Math.max(...flashcards.map(card => card.id)) + 1 : 1;
                const newCard = {
                    id: newId,
                    question,
                    logic,
                    tags: selectedTags,
                    questionImages: [...currentQuestionImages],
                    logicImages: [...currentLogicImages]
                };
                
                flashcards.push(newCard);
                
                // æ·»åŠ æ–°æ ‡ç­¾åˆ°æ ‡ç­¾åˆ—è¡¨
                selectedTags.forEach(tag => {
                    if (!tags.includes(tag)) {
                        tags.push(tag);
                        saveTags();
                    }
                });
            }
            
            // ä¿å­˜æ•°æ®
            saveFlashcards();
            
            // é‡ç½®è¡¨å•
            this.reset();
            questionPreview.innerHTML = "";
            logicPreview.innerHTML = "";
            currentQuestionImages = [];
            currentLogicImages = [];
            updateImageCount();
            
            // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
            alert(editingId ? "é—ªå¡æ›´æ–°æˆåŠŸï¼" : "é—ªå¡æ·»åŠ æˆåŠŸï¼");
            
            // è¿”å›å­¦ä¹ é¡µé¢
            currentStudyTag = "all";
            showPage('studyPage');
        });
        
        // å–æ¶ˆæ·»åŠ 
        cancelAddBtn.addEventListener('click', () => {
            currentStudyTag = "all";
            showPage('studyPage');
        });
        
        // æ·»åŠ æ–°æ ‡ç­¾
        document.getElementById('addTagBtn').addEventListener('click', function() {
            const newTagInput = document.getElementById('newTag');
            const newTag = newTagInput.value.trim();
            
            if (newTag) {
                // æ£€æŸ¥æ ‡ç­¾æ˜¯å¦å·²å­˜åœ¨
                if (!tags.includes(newTag)) {
                    tags.push(newTag);
                    saveTags();
                    
                    // æ›´æ–°è¡¨å•æ ‡ç­¾
                    updateFormTags();
                    
                    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    alert(`æ ‡ç­¾"${newTag}"å·²æ·»åŠ ï¼`);
                } else {
                    alert(`æ ‡ç­¾"${newTag}"å·²å­˜åœ¨ï¼`);
                }
                
                // æ¸…ç©ºè¾“å…¥æ¡†
                newTagInput.value = "";
            }
        });
        
        // è¿”å›æŒ‰é’®
        backFromTagsBtn.addEventListener('click', () => {
            currentStudyTag = "all";
            showPage('studyPage');
        });
        
        backFromLibraryBtn.addEventListener('click', () => {
            currentStudyTag = "all";
            showPage('studyPage');
        });
        
        // åˆå§‹åŒ–é¡µé¢
        loadData();
        initStudyPage();
        
        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºä¿å­˜çŠ¶æ€
        window.addEventListener('load', () => {
            setTimeout(() => {
                showSaveIndicator('å·²åŠ è½½æœ¬åœ°ä¿å­˜çš„æ•°æ®');
            }, 500);
        });
    </script>
</body>
</html>